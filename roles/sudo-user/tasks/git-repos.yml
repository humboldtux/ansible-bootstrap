---
- name: Définir les dépôts publics
  set_fact:
    public_repos:
      - repo: "https://github.com/humboldtux/scripts.git"
        name: "scripts"
      - repo: "https://github.com/humboldtux/cheats.git"
        name: "cheats"

- name: Définir les dépôts privés
  set_fact:
    private_repos:
      - repo: "git@github.com:humboldtux/scripts.git"
        name: "scripts"
      - repo: "git@github.com:humboldtux/cheats.git"
        name: "cheats"
      - repo: "git@github.com:humboldtux/scripts-priv.git"
        name: "scripts-priv"
      - repo: "git@github.com:humboldtux/cheats-priv.git"
        name: "cheats-priv"

- name: Sélectionner les dépôts à cloner en fonction de l'utilisateur
  set_fact:
    repos_to_clone: "{{ public_repos if sudo_user in ['sirm', 'snap', 'admin'] else private_repos }}"

# Clonage des dépôts Git
- name: Cloner les dépôts Git sélectionnés s'ils n'existent pas
  become: true
  become_user: "{{ sudo_user }}"
  git:
    repo: "{{ item.repo }}"
    dest: "/home/{{ sudo_user }}/dev/src/github.com/humboldtux/{{ item.name }}"
    clone: yes
    update: no
  loop: "{{ repos_to_clone }}"
  register: git_clone_results

- name: Ajouter tous les dépôts clonés à gita
  become: true
  become_user: "{{ sudo_user }}"
  shell: gita add ~/dev/src/github.com/humboldtux/*
  args:
    executable: /bin/bash
  when: git_clone_results is changed
