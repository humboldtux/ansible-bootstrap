---
- name: Définir les dépôts à cloner en fonction de l'utilisateur
  set_fact:
    repos_to_clone: |
      {% if sudo_user in ['sirm', 'snap', 'admin'] %}
      [{ 'repo': 'https://github.com/humboldtux/scripts.git', 'name': 'scripts' }, { 'repo': 'https://github.com/humboldtux/cheats.git', 'name': 'cheats' }]
      {% else %}
      [{ 'repo': 'git@github.com:humboldtux/scripts.git', 'name': 'scripts' }, { 'repo': 'git@github.com:humboldtux/cheats.git', 'name': 'cheats' }, { 'repo': 'git@github.com:humboldtux/scripts-priv.git', 'name': 'scripts-priv' }, { 'repo': 'git@github.com:humboldtux/cheats-priv.git', 'name': 'cheats-priv' }]
      {% endif %}

# Clonage des dépôts Git
- name: Cloner les dépôts Git sélectionnés s'ils n'existent pas
  become: true
  become_user: "{{ sudo_user }}"
  git:
    repo: "{{ item.repo }}"
    dest: "/home/{{ sudo_user }}/dev/src/github.com/humboldtux/{{ item.name }}"
    clone: yes
    update: no
  loop: "{{ repos_to_clone }}"
  register: git_clone_results

- name: Ajouter tous les dépôts clonés à gita
  become: true
  become_user: "{{ sudo_user }}"
  shell: gita add ~/dev/src/github.com/{{ sudo_user }}/*
  args:
    executable: /bin/bash
  when: git_clone_results is changed
